
@{
    ViewBag.Title = "Đăng ký xét tuyển";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    label {
        white-space: nowrap !important;
    }

    .span_with_for {
        width: 65px !important
    }

    .btn, .form-select, .form-control {
        border-radius: 3px;
    }

    .padding_input_text_number {
        padding-left: 0px !important;
        padding-right: 0px !important;
        text-align: center !important;
    }
</style>

<header class="page-header page-header-compact page-header-light border-bottom bg-white mb-2">
    <div class="container-fluid px-4">
        <div class="page-header-content">
            <div class="row align-items-center justify-content-between pt-3">
                <div class="col-auto mb-1">
                    <div class="page-header-title mb-2">
                        <div class="page-header-icon"><i data-feather="list"></i></div>
                        <span id="sp_tieude"></span>
                    </div>
                </div>

            </div>
        </div>
    </div>
</header>
 
<input id="key_check_set_update" type="hidden" />
 
<input type="hidden" id="ThiSinh_ID_DK_Prs" style="display:none!important" />
<input type="hidden" id="dkxt_hocba_id_checkin" style="display:none!important" />
<div class="container-fluid px-12">
    <div id="div_list_aspirations">
        <div class="card card-header-actions">
            <div class="card-header">
                <span>Các nguyện vọng đã đăng ký</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12" id="div_thead" style="display:none">
                        <div class="row g-1">
                            <div class="col-lg-1 col-sm-12"><b>Nguyện vọng</b></div>
                            <div class="col-lg-3 col-sm-12"><b>Ngành</b></div>
                            <div class="col-lg-2 col-sm-12"><b>Tổ hợp môn</b></div>
                            <div class="col-lg-2 col-sm-12"><b>Tổng điểm (có ưu tiên)</b></div>
                            <div class="col-xl-2 col-lg-12"><b>Ngày đăng ký</b></div>
                            <div class="col-lg-2 col-sm-12"><b style="margin-left:10px">Cập nhật</b> </div>
                        </div>
                        <div class="col-12"><hr class="mt-2 mb-0" /><hr class="mt-0 mb-2" /></div>
                    </div>
                    <div id="div_tbody_list"></div>
                    <script>
                        // phần hiển thị dữ liệu đã đăng ký
                        $(document).ready(function () {
                            LoadData_All_DkxtHB();
                            KhoaHeThongDangKy($('#key_check_set_update').val())
                        });
                        function ConvertDateToString(date) {
                            var parts = date.split('-');
                            var mydate = parts[2] + '/' + parts[1] + '/' + parts[0];
                            return mydate;
                        }

                        function ConvertStringToDate(str) {
                            var mdy = str.split('-');
                            return new Date(mdy[0], mdy[1], mdy[2]);
                        }

                        function LoadData_All_DkxtHB() {
                            $('#div_tbody_list').empty();

                            $.ajax({
                                url: "/DangKyXetTuyens/DangKyXetTuyen_HB_ListAll/",
                                type: 'GET',
                                contentType: 'application/json;charset=utf-8',
                                dataType: 'json',
                                async: false,
                                success: function (res) {
                                    console.log(res);

                                    $('#ThiSinh_ID_DK_Prs').val(res.Tsdk_id_dk);
                                    $('#span_Uutien_doituong').html(res.DkxtTenDoituongDiem);
                                    $('#span_Uutien_khuvuc').html(res.DkxtTenKhuvucDiem);
                                    $('#txt_hocluc_12').val(res.DkxtXeploaiHocluc12);
                                    $('#txt_hanhkiem_12').val(res.DkxtXeploaiHanhkiem12);
                                    $('#key_check_set_update').val(res.CheckSetUpdate)
                                    if (res.DkxtHocBaList == 0) {
                                        let div_item = ` <div class="col-12 text-center">Chưa có dữ liệu đăng ký xét tuyển</div>`;
                                        $('#div_tbody_list').append(div_item);
                                    }
                                    else {
                                        $.each(res.DkxtHocBaList, function (i, result) {
                                            if (res.DkxtHocBaList.length == 1) {
                                                let div_item = "";
                                                div_item += `<div class="row g-1">`;
                                                div_item += `<div class="col-xl-1 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- </span><span class="col-4  ">Nguyện vọng ` + result.dkxt_NguyenVong + `</div>`;
                                                div_item += `<div class="col-xl-3 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- Ngành: </span><span class="col-8 span_noidung_nv">` + result.dkxt_TenAll.nganh_GhiChu + `</span></div>`;
                                                div_item += `<div class="col-xl-2 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- Tổ hợp môn: </span> <span class="col-8 span_noidung_nv">` + result.dkxt_TenAll.thm_MaTen + `</span></div>`;
                                                div_item += `<div class="col-xl-2 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- Tổng điểm (có ưu tiên): </span><span class="col-8 span_noidung_nv">` + result.dkxt_Diem_Tong_Full + `</span></div>`;
                                                div_item += `<div class="col-xl-2 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- Ngày đăng ký: </span><span class="col-8 span_noidung_nv">` + ConvertDateToString(result.Dkxt_NgayDK) + `</span></div>`;
                                                div_item += `<div class="col-xl-2 col-lg-12  text-nowrap">`;
                                                div_item += `<button class="btn btn-sm btn-outline-success check_disable" style="margin-left:10px" onclick="DkxtthHbDetail(${result.dkxt_ID})">Xem</button>&nbsp;<button class="btn btn-outline-primary btn-sm" onclick="UpdateRecordOnTableOnclick(${result.dkxt_ID},${result.dkxt_HB_TrangThai_HoSo})">Sửa</button>&nbsp;<button class="btn btn-outline-danger btn-sm" onclick="DeleteRecordOnTableOnclick(${result.dkxt_ID},${result.dkxt_HB_TrangThai_HoSo})">Xoá</button>`;
                                                div_item += `</div>`;
                                                div_item += `<div class="col-12"><hr class="mt-1 mb-2"/></div>`;
                                                $('#div_tbody_list').append(div_item);
                                            }
                                            else if (res.DkxtHocBaList.length > 1) {
                                                let div_item = "";
                                                div_item += `<div class="row g-1">`;
                                                div_item += `<div class="col-xl-1 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- </span><span class="col-4  ">Nguyện vọng ` + result.dkxt_NguyenVong + `</span ></div>`;
                                                div_item += `<div class="col-xl-3 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- Ngành: </span><span class="col-8 span_noidung_nv">` + result.dkxt_TenAll.nganh_GhiChu + `</span></div>`;
                                                div_item += `<div class="col-xl-2 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- Tổ hợp môn: </span> <span class="col-8 span_noidung_nv">` + result.dkxt_TenAll.thm_MaTen + `</span></div>`;
                                                div_item += `<div class="col-xl-2 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- Tổng điểm (có ưu tiên): </span><span class="col-8 span_noidung_nv">` + result.dkxt_Diem_Tong_Full + `</span></div>`;
                                                div_item += `<div class="col-xl-2 col-lg-12  text-nowrap"><span class="col-4  span_thongtin_nv">- Ngày đăng ký: </span><span class="col-8 span_noidung_nv">` + ConvertDateToString(result.Dkxt_NgayDK) + `</span></div>`;
                                                div_item += `<div class="col-xl-2 col-lg-12  text-nowrap">`;
                                                div_item += `<button style="margin-left:10px" class="btn btn-outline-info btn-sm check_disable ${i == 0 ? "dautien" : ''}" onclick="change_up_aspirations_on_table_onclick(${result.dkxt_ID})" ${i == 0 ? "disabled" : ''}><b>&#8743;</b></button>&nbsp;<button class="btn btn-outline-warning btn-sm check_disable ${i == res.DkxtHocBaList.length - 1 ? "cuoicung" : ""}" onclick="change_down_aspirations_on_table_onclick(${result.dkxt_ID})" ${i == res.DkxtHocBaList.length - 1 ? "disabled" : ""}><b>&#8744;</b></button>`
                                                div_item += `&nbsp;<button class="btn btn-sm btn-outline-success"  onclick="DkxtthHbDetail(${result.dkxt_ID})">Xem</button>&nbsp;<button class="btn btn-outline-primary btn-sm check_disable" onclick="UpdateRecordOnTableOnclick(${result.dkxt_ID},${result.dkxt_HB_TrangThai_HoSo})">Sửa</button>&nbsp;<button class="btn btn-outline-danger btn-sm check_disable" onclick="DeleteRecordOnTableOnclick(${result.dkxt_ID},${result.dkxt_HB_TrangThai_HoSo})">Xoá</button>`;
                                                div_item += `</div>`;
                                                div_item += `<div class="col-12"><hr class="mt-1 mb-2"/></div>`;
                                                $('#div_tbody_list').append(div_item);
                                            }
                                        });
                                    }
                                    if (window.innerWidth <= 1000) {
                                        $('#div_thead').css('display', 'none');
                                        $('#div_thead').hide();
                                        $('.span_thongtin_nv').css('display', 'inline');
                                        $('.span_thongtin_nv').show();
                                        $('.span_noidung_nv').css('font-weight', 'bold')
                                    }
                                    else {
                                        $('#div_thead').css('display', 'inline');
                                        $('#div_thead').show();
                                        $('.span_thongtin_nv').css('display', 'none');
                                        $('.span_thongtin_nv').hide();
                                        $('.span_noidung_nv').css('font-weight', 'normal')
                                    }  
                                    
                                },
                                error: function (errormessage) {
                                    alert(errormessage.responseText);
                                }
                            });
                        }
                        function DkxtthHbDetail(dkxt_id) {
                            var str_url = '?dkxt_id=' + dkxt_id;
                            window.location.href = "/DangKyXetTuyens/DkxthocbaDetail" + str_url;
                        }
                        function KhoaHeThongDangKy(keyCheck) {
                            if (keyCheck == 0) {
                                $('.check_disable').prop('disabled', true);
                                $('#bt_add_aspirations').prop('disabled', true);
                                $('#p_thongbao_khoadangky').css('display', 'inline');
                                
                            }
                            else {
                                $('.check_disable').prop('disabled', false);
                                $('#bt_add_aspirations').prop('disabled', false);
                                $('#p_thongbao_khoadangky').css('display', 'none');
                                $('.dautien').prop('disabled', true);
                                $('.cuoicung').prop('disabled', true);
                            }
                        }
                    </script>
                </div>

                <div class="row">
                    <div class="col-12">
                        <center>
                            <button id="bt_xuat_phieu_tong_hop_kq" class="btn btn-outline-success">Xuất phiếu tổng hợp</button>
                            <button id="bt_add_aspirations" class="btn btn-outline-primary">Thêm nguyện vọng</button>
                          
                            <script>
                                $(document).ready(function () {
                                    let sp_tieude = $('#sp_tieude');
                                    let bt_xuat_phieu_tong_hop = $('#bt_xuat_phieu_tong_hop_kq');
                                    let bt_them_nguyen_vong = $('#bt_add_aspirations');
                                    if (window.innerWidth <= 1000) {

                                        sp_tieude.text('Đăng ký xét tuyển bằng điểm học bạ');
                                        bt_xuat_phieu_tong_hop.text('Xuất phiếu');
                                        bt_them_nguyen_vong.text("Thêm nguyện vọng");

                                        $('#div_thead').css('display', 'none');
                                        $('#div_thead').hide();
                                        $('.span_thongtin_nv').css('display', 'inline');
                                        $('.span_thongtin_nv').show();
                                        $('.span_noidung_nv').css('font-weight', 'bold')
                                    }
                                    else {
                                        sp_tieude.text('Đăng ký xét tuyển sử dụng kết quả học tập ở trung học phổ thông (Xét tuyển bằng học bạ)');
                                        bt_xuat_phieu_tong_hop.text('Xuất phiếu tổng hợp');
                                        bt_them_nguyen_vong.text("Thêm nguyện vọng");

                                        $('#div_thead').css('display', 'inline');
                                        $('#div_thead').show();
                                        $('.span_thongtin_nv').css('display', 'none');
                                        $('.span_thongtin_nv').hide();
                                        $('.span_noidung_nv').css('font-weight', 'normal')
                                    }
                                    function reportWindowSize() {
                                        if (window.innerWidth <= 1000) {

                                            sp_tieude.text('Đăng ký xét tuyển bằng điểm học bạ');
                                            bt_xuat_phieu_tong_hop.text('Xuất phiếu');
                                            bt_them_nguyen_vong.text("Thêm nguyện vọng");

                                            $('#div_thead').css('display', 'none');
                                            $('#div_thead').hide();
                                            $('.span_thongtin_nv').css('display', 'inline');
                                            $('.span_thongtin_nv').show();
                                            $('.span_noidung_nv').css('font-weight', 'bold')

                                        }
                                        else {
                                            sp_tieude.text('Đăng ký xét tuyển sử dụng kết quả học tập ở trung học phổ thông (Xét tuyển bằng học bạ)');
                                            bt_xuat_phieu_tong_hop.text('Xuất phiếu tổng hợp');
                                            bt_them_nguyen_vong.text("Thêm nguyện vọng");

                                            $('#div_thead').css('display', 'inline');
                                            $('#div_thead').show();
                                            $('.span_thongtin_nv').css('display', 'none');
                                            $('.span_thongtin_nv').hide();
                                            $('.span_noidung_nv').css('font-weight', 'normal');
                                        }
                                    }
                                    window.onresize = reportWindowSize;
                                })

                            </script>
                        </center>
                    </div>
                </div>
                <div class="col-12"><hr class="mt-1 mb-1" /></div>
                <div class="row">
                    <div class="col-xxl-12">
                        <p style="color:red; font-style:italic" class="mb-1">Lưu ý: </p>
                        <p style="color:blue; font-style:italic; text-align:justify; display:none" class="mb-1" id="p_thongbao_khoadangky">- Đã hết thời gian đăng ký nguyện vọng, bạn chỉ có thể xem các nguyện vọng đã đăng ký.</p>
                        <p style="color:red; font-style:italic; text-align:justify" class="mb-1">- Thí sinh cần nộp lệ phí xét tuyển và gửi minh chứng trong phần thông tin lệ phí (ảnh chụp giao dịch chuyển tiền).</p>
                        <p style="color: red; font-style: italic; text-align: justify" class="mb-1">- Thí sinh in phiếu tổng hợp nguyện vọng đăng ký của phương thức này, kiểm tra lại thông tin trong phiếu, ký xác nhận và gửi về trường theo đường bưu điện.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="div_update_aspirations" style="display:none">
        <div class="card card-header-actions">
            <div class="card-header">
                <span>Đăng ký nguyện vọng mới</span>
                @*<button class="btn-close" type="button" aria-label="Close"></button>*@
                <button class="btn-close" id="bt_close_div_update_aspirations_first" type="button" aria-label="Close"></button>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-4 col-md-12">
                        <div class="row table-hover">
                            <div class="col-12"><b>Chọn ngành và tổ hợp môn <font color="red">(*)</font></b></div>
                            <div class="col-12"><hr class="mt-1 mb-0" /><hr class="mt-0 mb-2" /></div>
                        </div>
                        <div class="row">
                            <div class="col-4">Khối ngành</div>
                            <div class="col-8"><select id="select_khoinganh" class="form-select"></select></div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-2" /></div>
                        <div class="row">
                            <div class="col-4">Ngành</div>
                            <div class="col-8">
                                <select id="select_nganh" class="form-select"></select>
                                <span id="Nganh_ID_Error" class="small mb-1 text-danger"></span>
                            </div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-2" /></div>
                        <div class="row">
                            <div class="col-4">Tổ hợp môn</div>
                            <div class="col-8">
                                <select id="select_tohopmon" class="form-select"></select>
                                <span id="Thm_ID_Error" class="small mb-1 text-danger"></span>
                            </div>
                            <div class="col-12"><hr class="mt-1 mb-2" /></div>
                        </div>
                        <div class="row">
                            <div class="col-6 ">
                                <span id="span_Uutien_doituong"></span>
                                <hr />
                            </div>
                            <div class="col-6  ">
                                <span id="span_Uutien_khuvuc"></span>
                                <hr />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <span> Học lực lớp 12</span>
                                <input id="txt_hocluc_12" type="text" class="form-control" value="" disabled />
                            </div>
                            <div class="col-6">
                                <span>Hạnh kiểm lớp 12</span>
                                <input id="txt_hanhkiem_12" type="text" class="form-control" value="" disabled />
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-12">
                        <div class="row">
                            <div class="col-12"><b>Điểm các môn xét tuyển <font color="red">(*)</font></b></div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-0" /><hr class="mt-0 mb-2" /></div>
                        <div class="row g-1">
                            <div class="col-3"><span style="visibility:hidden">TenHK</span></div>
                            <div class="col-2">K1/11</div>
                            <div class="col-2">K2/11</div>
                            <div class="col-2">K1/12</div>
                            <div class="col-3">TBC</div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-2" /></div>
                        <div class="row g-1">
                            <div class="col-3"><label id="lb_tenmon_1" class="form-label">Chưa chọn</label></div>
                            <div class="col-2"><input id="txt_m1_k1" type="number" class="form-control input-mon1 padding_input_text_number " value="" disabled /></div>
                            <div class="col-2"><input id="txt_m1_k2" type="number" class="form-control input-mon1 padding_input_text_number " value="" disabled /></div>
                            <div class="col-2"><input id="txt_m1_k3" type="number" class="form-control input-mon1 padding_input_text_number " value="" disabled /></div>
                            <div class="col-3"><input id="txt_tb_m1" type="text" class="form-control padding_input_text_number input-tong" value="" disabled /></div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-2" /></div>
                        <div class="row g-1">
                            <div class="col-3"><label id="lb_tenmon_2" class="form-label">Chưa chọn</label></div>
                            <div class="col-2"><input id="txt_m2_k1" type="number" class="form-control input-mon2 padding_input_text_number " value="" disabled /></div>
                            <div class="col-2"><input id="txt_m2_k2" type="number" class="form-control input-mon2 padding_input_text_number " value="" disabled /></div>
                            <div class="col-2"><input id="txt_m2_k3" type="number" class="form-control input-mon2 padding_input_text_number " value="" disabled /></div>
                            <div class="col-3"><input id="txt_tb_m2" type="text" class="form-control padding_input_text_number input-tong" value="" disabled /></div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-2" /></div>
                        <div class="row g-1">
                            <div class="col-3"><label id="lb_tenmon_3" class="form-label">Chưa chọn</label></div>
                            <div class="col-2"><input id="txt_m3_k1" type="number" class="form-control input-mon3 padding_input_text_number " value="" disabled /></div>
                            <div class="col-2"><input id="txt_m3_k2" type="number" class="form-control input-mon3 padding_input_text_number " value="" disabled /></div>
                            <div class="col-2"><input id="txt_m3_k3" type="number" class="form-control input-mon3 padding_input_text_number " value="" disabled /></div>
                            <div class="col-3"><input id="txt_tb_m3" type="text" class="form-control padding_input_text_number input-tong" value="" disabled /></div>
                        </div>
                        <div class="col-12"> <span id="Diem_All_Error" class="small mb-1 text-danger"></span></div>
                        <div class="col-12"><hr class="mt-1 mb-2" /></div>
                        <div class="row">
                            <div class="col-12"><b> Minh chứng học bạ <font color="red">(*)</font></b></div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-0" /><hr class="mt-0 mb-2" /></div>
                        <div class="row">
                            <div class="col-12">
                                <input id="files_hocba" type="file" multiple class="form-control small" data-val="true" data-val-required="Vui lòng chọn file học bạ" accept=".pdf,.png, .PNG,.jpeg,.JPEG,.jpg,.JPG" />
                                <span id="SP_HocBa_Error" class="small mb-1 text-danger"></span>
                            </div>
                            <div class="col-12">
                                <table class="table mt-1 mb-0" id="FilesList_HocBa_View" style="visibility:hidden"><tr style="display:none"><th colspan="2"><input type="hidden" id="txt_uploader_file_hocba" /></th></tr></table>
                            </div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-2" /></div>
                    </div>

                    <div class="col-lg-4 col-md-12">
                        <div class="row">
                            <div class="col-12"><b>Minh chứng khác</b></div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-0" /><hr class="mt-0 mb-2" /></div>
                        <div class="row">
                            <div class="col-12">Căn cước công dân</div>
                            <div class="col-12">
                                <input class="form-control small" id="files_cancuoc_congdan" multiple="multiple" name="files_cancuoc_congdan" type="file" data-val="true" accept=".pdf,.png, .PNG,.jpeg,.JPEG,.jpg,.JPG" />
                            </div>
                            <div class="col-xxl-12">
                                <table class="table mt-1 mb-0" id="FilesList_CCCD_View" style="visibility:hidden"> <tr style="display:none"><th colspan="2"><input type="hidden" id="txt_uploader_file_cccd" /></th></tr></table>
                            </div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-0" /></div>
                        <div class="row">
                            <div class="col-12">Bằng Tốt nghiệp (nếu có)</div>
                            <div class="col-12">
                                <input class="form-control small" id="files_bangtn" multiple="multiple" name="files_bangtn" type="file" data-val="true" accept=".pdf,.png, .PNG,.jpeg,.JPEG,.jpg,.JPG" />
                            </div>
                            <div class="col-12">
                                <table class="table mt-1 mb-0" id="FilesList_BangTN_View" style="visibility:hidden"> <tr style="display:none"><th colspan="2"><input type="hidden" id="txt_uploader_file_bangtn" /></th></tr></table>
                            </div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-0" /></div>
                        <div class="row">
                            <div class="col-12">Giấy tờ ưu tiên (nếu có)</div>
                            <div class="col-12">
                                <input class="form-control small" id="files_giayto_uutien" multiple="multiple" name="files_giayto_uutien" type="file" data-val="true" accept=".pdf,.png, .PNG,.jpeg,.JPEG,.jpg,.JPG" />
                            </div>
                            <div class="col-12">
                                <table class="table mt-1 mb-0" id="FilesList_GTUT_View" style="visibility:hidden"><tr style="display:none"><th colspan="2"><input type="hidden" id="txt_uploader_file_g" /></th></tr></table>
                            </div>
                        </div>
                        <div class="col-12"><hr class="mt-1 mb-0" /></div>
                    </div>
                </div>

                <div class="row mt-2 mb-3">
                    <div class="col-12" style="text-align:center">
                        <input class="btn btn-outline-primary col-lg-1 col-5" id="bt_ok_div_update_aspirations" type="button" value="Đồng ý thêm" />
                        <input class="btn btn-outline-secondary col-lg-1 col-4" id="bt_close_div_update_aspirations_second" type="button" value="Quay lại" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="myToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Toast Title</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
            </div>
        </div>
    </div>
</div>

<style>
    #loadingModal {
        background-color: rgba(0, 0, 0, 0.5);
        background-color: transparent;
    }
</style>

<div class="modal fade" id="modal_Action_Notifi" tabindex="-1" role="dialog" aria-labelledby="modal_Action_Notifi" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_title">Thông báo</h5>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close" id="bt_cancel_on_modal_delete_first"></button>
            </div>
            <div class="modal-body">
                <span id="span_conten_action_notifi"></span>
                <input id="key_delete_dkxt_id" type="hidden" />

            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal" id="bt_cancel_on_modal_delete_second">Hủy</button>
                <button class="btn btn-primary" type="button" id="bt_ok_on_modal_delete" style="display:none">Đồng ý</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_tb_thaydoinv" tabindex="-1" role="dialog" aria-labelledby="modal_tb_thaydoinv" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_tb_thaydoinv">Thông báo</h5>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close" id="bt_cancel_on_modal_change_first"></button>
            </div>
            <div class="modal-body">
                <span id="infor_change">Bạn chắc chắn thay đổi nguyện vọng này?</span>
                <input id="key_change_dkxt_hocba_id" type="hidden" />
                <input id="key_check_down_up" type="hidden" />
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal" id="bt_cancel_on_modal_change_second">Hủy</button>
                <button class="btn btn-primary" type="button" id="bt_ok_on_modal_change">Đồng ý</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="loadingModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_tb_thanhcong" tabindex="-1" role="dialog" aria-labelledby="modal_tb_thanhcong" aria-hidden="false">
    <div class="modal-dialog modal-dialog-centered modal" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thông báo</h5>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close" onclick="modal_tb_thanhcong_hide_click()"></button>
                <script>
                    function modal_tb_thanhcong_hide_click() { $('#modal_tb_thanhcong').modal('hide'); $('#noidung_chuyenkhoan').text(''); }
                    function thongbao_dangky_thanhcong(text) { $('#noidung_chuyenkhoan').text(text); $('#modal_tb_thanhcong').modal('show'); }
                </script>
            </div>
            <div class="modal-body">
                <p class="mt-0 mb-0" style="text-align:justify">- Đăng ký xét tuyển thành công!</p>
                <p class="mt-0 mb-0" style="text-align:justify">- Vui lòng nộp lệ phí xét tuyển bằng cách chuyển số tiền 50.000đ vào số tài khoản: <font color="red">5011100925</font> để hoàn thành thủ tục đăng ký xét tuyển</p>
                <p style="text-align:justify">- Nội dung chuyển khoản: <a id="noidung_chuyenkhoan" style="color:blue;text-decoration:none"></a></p>
                <input id="key_delete_dkxt_id" type="hidden" />
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal" onclick="modal_tb_thanhcong_hide_click()">Đóng</button>
            </div>
        </div>
    </div>
</div>
<script>
    // phần hiển thị dữ liệu đã đăng ký


    function UpdateRecordOnTableOnclick(dkxt_id, _check_delete) {
        if (_check_delete == 9) {
            $('#span_conten_action_notifi').text('');
            $("#span_conten_action_notifi").css("color", "blue");
            $('#span_conten_action_notifi').text('Nguyện vọng đã được duyệt, không thể sửa!');
            $('#bt_cancel_on_modal_delete_second').text('Đóng');
            $('#bt_ok_on_modal_delete').css('display', 'none');

            $('#bt_ok_on_modal_delete').hide();
            $('#modal_Action_Notifi').modal('show');
        }
        else {
            var str_url = '?dkxt_id=' + dkxt_id;
            window.location.href = "/DangKyXetTuyens/DkxthocbaEdit" + str_url;
        }
    }
    // button xóa nguyện vọng đã đăng ký:
    function DeleteRecordOnTableOnclick(_dkxt_id, _check_delete) {
        if (_check_delete == 9) {
            $('#span_conten_action_notifi').text('');
            $('#span_conten_action_notifi').css('color', 'blue');
            $('#span_conten_action_notifi').text('Nguyện vọng đã được duyệt, không thể xóa');
            $('#bt_cancel_on_modal_delete_second').text('Đóng');
            $('#bt_ok_on_modal_delete').css('display', 'none');

            $('#bt_ok_on_modal_delete').hide();
            $('#modal_Action_Notifi').modal('show');
        }
        else {
            $('#span_conten_action_notifi').text('');
            $('#span_conten_action_notifi').css('color', 'red');
            $('#span_conten_action_notifi').text('Nếu đồng ý sẽ xóa tất cả dữ liệu của nguyện vọng này. Bạn chắc chắn xóa?');
            $('#bt_cancel_on_modal_delete_second').text('Hủy');
            $('#modal_Action_Notifi').modal('show');
            $('#bt_ok_on_modal_delete').show();
            $('#bt_ok_on_modal_delete').css('display', 'inline');
            $('#key_delete_dkxt_id').val(_dkxt_id)
        }
    }

    // thay đổi nguyện vọng đã đăng ký:
    function change_up_aspirations_on_table_onclick(_dkxt_hb_id) {
        $('#key_change_dkxt_hocba_id').val('');
        $('#key_check_down_up').val('');

        $('#key_change_dkxt_hocba_id').val(_dkxt_hb_id);
        $('#key_check_down_up').val('1');
        $('#infor_change').text('Bạn chắc chắn đổi nguyện vọng này lên trước?');
        $('#modal_tb_thaydoinv').modal('show');
    }
    function change_down_aspirations_on_table_onclick(_dkxt_hb_id) {
        $('#key_change_dkxt_hocba_id').val('');
        $('#key_check_down_up').val('');

        $('#infor_change').text('Bạn chắc chắn đổi nguyện vọng này xuống sau?');
        $('#key_change_dkxt_hocba_id').val(_dkxt_hb_id);
        $('#key_check_down_up').val('2');
        $('#modal_tb_thaydoinv').modal('show');
    }


    $(document).ready(function () {
        $('#bt_ok_on_modal_delete').click(function () {
            let data = {
                Dkxt_HB_ID: $('#key_delete_dkxt_id').val(),
            };
            $.ajax({
                url: "/DangKyXetTuyens/DangKyXetTuyen_HB_Delete",
                data: JSON.stringify(data),
                type: 'POST',
                contentType: 'application/json;charset=utf-8',
                dataType: 'json',
                success: function (res) {
                    if (res.status == true) {
                        LoadData_All_DkxtHB();
                        $('#modal_Action_Notifi').modal('hide');
                        showToast("Thông báo", "Đã thực hiên xóa nguyện vọng!", "bg-success");
                    }
                    else {
                        showToast("Lỗi", res.msg, "bg-success");
                    }
                },
                error: function (errormessage) {
                    showToast("Thông báo", "Lỗi! Chưa thể xóa theo yêu cầu!", "bg-success");
                }
            });
        });

        $('#bt_cancel_on_modal_delete_first').click(function () {
            $('#modal_Action_Notifi').modal('hide');
            $('#key_delete_dkxt_id').val('');
            $('#span_conten_action_notifi').text('');
        });

        $('#bt_cancel_on_modal_delete_second').click(function () {
            $('#modal_Action_Notifi').modal('hide');
            $('#key_delete_dkxt_id').val('');
            $('#span_conten_action_notifi').text('');
        });
        $('#bt_ok_on_modal_change').click(function () {
            let _check_action = $('#key_check_down_up').val();
            let data_Obj_change = { Dkxt_HB_ID: $('#key_change_dkxt_hocba_id').val() };

            if (_check_action == 1) { // sửa lên trên
                $.ajax({
                    url: "/DangKyXetTuyens/DangKyXetTuyen_HB_Change_UpData",
                    data: JSON.stringify(data_Obj_change),
                    type: 'POST',
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (res) {
                        console.log(res);
                        if (res.status == true) {
                            LoadData_All_DkxtHB();
                            $('#modal_tb_thaydoinv').modal('hide');
                            $('#key_change_dkxt_hocba_id').val('');
                            $('#key_check_down_up').val('');
                            showToast("Thông báo", "Đã thực hiện thay đổi nguyện vọng!", "bg-success");
                        }
                        else {
                            if (res.msg == 1) {
                                $('#modal_tb_thaydoinv').modal('hide');
                                showToast("Thông báo", "Đây là nguyện vọng 1", "bg-success");
                                console.log(res.msg);
                            }
                            if (res.msg == 0) {
                                $('#modal_tb_thaydoinv').modal('hide');
                                showToast("Thông báo", "Không thể thực hiện yêu cầu này", "bg-success");
                                console.log(res.msg);
                            }                          
                        }
                    },
                    error: function (errormessage) {
                        $('#modal_tb_thaydoinv').modal('hide');
                        console.log(errormessage);
                        showToast("Thông báo", "Không thể thực hiện yêu cầu này", "bg-success");
                    }
                });
            }
            if (_check_action == 2) { // sửa xuống dưới
                $.ajax({
                    url: "/DangKyXetTuyens/DangKyXetTuyen_HB_Change_DownData",
                    data: JSON.stringify(data_Obj_change),
                    type: 'POST',
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (res) {
                        console.log(res);
                        if (res.status == true) {
                            LoadData_All_DkxtHB();
                            $('#modal_tb_thaydoinv').modal('hide');
                            $('#key_change_dkxt_kqtthptqg_id').val('');
                            $('#key_check_down_up').val('');
                            showToast("Thông báo", "Đã thực hiện thay đổi nguyện vọng!", "bg-success");
                        }
                        else {
                            showToast("Lỗi", res.msg, "bg-success");
                            console.log(response.msg);
                        }
                    },
                    error: function (errormessage) {
                        showToast("Thông báo", "Lỗi! Chưa thể thực hiện theo yêu cầu!", "bg-success");
                    }
                });
            }
        });

        $('#bt_cancel_on_modal_change_first').click(function () {
            $('#modal_tb_thaydoinv').modal('hide');
            $('#key_change_dkxt_hocba_id').val('');
            $('#key_check_down_up').val('');
        })

        $('#bt_cancel_on_modal_change_second').click(function () {
            $('#modal_tb_thaydoinv').modal('hide');
            $('#key_change_dkxt_hocba_id').val('');
            $('#key_check_down_up').val('');
        })

    });


    // hết phần hiển thị dữ liệu đã đăng ký

    // phần xử lý dữ liệu cho div update


    var check_in_file_hoba = false;
    var formdata_files_hocba = new FormData();
    var formdata_cccd = new FormData();
    var formdata_bang_tn = new FormData();
    var formdata_giayto_uutien = new FormData();

    $(document).ready(function () {
        $("#select_khoinganh").change(function () {
            select_nganh_view_data($("#select_khoinganh").val(), 0, 0);
            reset_fields_controll_disabled_true()
        });
        $("#select_nganh").change(function () {
            select_tohopmon_view_data($("#select_nganh").val(), 0, 0);
            reset_fields_controll_disabled_true()
        });

        $("#select_tohopmon").change(function () {

            let dataObj = {
                ThiSinh_ID: $('#ThiSinh_ID_DK_Prs').val(),
                Thm_ID: $("#select_tohopmon").val(),
                Nganh_ID: $("#select_nganh").val(),
                Dkxt_HB_ID: $('#dkxt_hocba_id_checkin').val()
            }
            // trường hợp là thêm mới
            if (dataObj.Dkxt_HB_ID == 0 && dataObj.Thm_ID > 0) {
                $.ajax({
                    url: "/DangKyXetTuyens/DangKyXetTuyen_HB_Get_Data_MonHoc",
                    data: JSON.stringify(dataObj),
                    type: 'POST',
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (res) {
                        if (res.success == true) {
                            reset_fields_controll_disabled_false();
                            $('#lb_tenmon_1').text(res.data.thm_Mon1);
                            $('#lb_tenmon_2').text(res.data.thm_Mon2);
                            $('#lb_tenmon_3').text(res.data.thm_Mon3);
                            $('#txt_m1').focus();
                        }
                        if (res.success == false) {
                            reset_fields_controll_disabled_true();
                            $('#Nganh_ID_Error').text('Trùng ngành và tổ hợp môn, vui lòng chọn lại');
                            $('#Thm_ID_Error').text('Trùng ngành và tổ hợp môn, vui lòng chọn lại');
                        }
                    },
                    error: function (errormessage) {
                        console.log(errormessage.error);
                    }
                });
            }
            // trường hợp sửa => chưa làm
            else if (dataObj.Dkxt_HB_ID == 0 && dataObj.Thm_ID == 0) {
                reset_fields_controll_disabled_true()
            }
        });

        on_listen_fields_input_data(".input-mon1", '#txt_tb_m1');
        on_listen_fields_input_data(".input-mon2", '#txt_tb_m2');
        on_listen_fields_input_data(".input-mon3", '#txt_tb_m3');

        $('input').on('input', function () {
            hideErrorMessage($(this));
        });

        $('select').on('input', function () {
            var arr_select = $('.form-select');
            arr_select.each(function () {
                hideErrorMessage($(this));
            })
            /*  hideErrorMessage($(this));*/
        })
        // button hiển thị cửa sổ thêm mới
        $('#bt_add_aspirations').click(function () {
            document.getElementById('div_list_aspirations').style.display = "none";
            document.getElementById('div_update_aspirations').style.display = "inline";
            select_khoinganh_view_data(0, 0, 0);
            reset_fields_controll_disabled_true();
            $('#dkxt_hocba_id_checkin').val('0');

            check_in_file_hoba = false;
            formdata_files_hocba = new FormData();
            formdata_cccd = new FormData();
            formdata_bang_tn = new FormData();
            formdata_giayto_uutien = new FormData();
        });
    });



    function select_khoinganh_view_data(khoinganh_key, nganh_key, tohopmon_key) {
        $('#select_khoinganh').empty()
        $.ajax({
            url: "/DangKyXetTuyens/KhoiNganhListAll",
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result_all) {
                $.each(result_all, function (i, result) {
                    $('#select_khoinganh').append('<option value="' + result.khoiNganh_ID + '">' + result.khoiNganh_Ten + '</option>');
                });

                $('#select_khoinganh').val(khoinganh_key);
                select_nganh_view_data(khoinganh_key, nganh_key, tohopmon_key);
            },
            error: function (errormessage) {
                console.log(errormessage.responseText);
            }
        });
    }
    function select_nganh_view_data(id, nganh_key, tohopmon_key) {
        $("#select_nganh").empty();
        $.ajax({
            url: "/DangKyXetTuyens/NganhListAll/" + id,
            type: 'GET',
            contentType: 'application/json;charset=utf-8',
            dataType: 'json',
            success: function (result_all) {
                $.each(result_all, function (i, result) {
                    $('#select_nganh').append('<option value="' + result.nganh_ID + '">' + result.nganh_GhiChu + '</option>');
                });

                $('#select_nganh').val(nganh_key);
                select_tohopmon_view_data(nganh_key, tohopmon_key);
            },
            error: function (errormessage) {
                console.log(errormessage.responseText);
            }
        });
    }
    function select_tohopmon_view_data(id, tohopmon_key) { // id = Nganh_ID
        $("#select_tohopmon").empty();
        $.ajax({
            url: "/DangKyXetTuyens/ToHopMonNganhListAll/" + id,
            type: 'GET',
            contentType: 'application/json;charset=utf-8',
            dataType: 'json',
            success: function (result_all) {
                $.each(result_all, function (i, result) {
                    $('#select_tohopmon').append('<option value="' + result.thm_ID + '">' + result.thm_MaTen + '</option>');
                });
                $('#select_tohopmon').val(tohopmon_key);
            },
            error: function (errormessage) {
                console.log(errormessage.responseText);
            }
        });
    }
    function on_listen_fields_input_data(inputClass, outputClass) {
        var inputFields = $(inputClass);
        inputFields.on('input', function () {
            var allFilled = true;
            inputFields.each(function () {
                if ($(this).val() === '' || $(this).val() < 0 || $(this).val() > 10) {
                    allFilled = false;
                    var errorMessage = "Chưa nhập đủ điểm các môn hoặc nhập chưa đúng, vui lòng kiểm tra lại!"; $('#Diem_All_Error').text(errorMessage);
                    $(outputClass).val('');
                    return false;
                }
            });

            if (allFilled) {
                $('#Diem_All_Error').text('');
                let total = 0;
                inputFields.each(function () {
                    total += parseFloat($(this).val());
                });
                /* console.log(total / 3)*/
                $(outputClass).val((total / 3).toFixed(2));
            }
        });
    }

    function hideErrorMessage(input) {
        var errorContainer = input.next('.text-danger');
        errorContainer.text('');
    }
    function reset_fields_controll_disabled_false() {

        $('#lb_tenmon_1').text("Chưa chọn");
        $('#lb_tenmon_2').text("Chưa chọn");
        $('#lb_tenmon_3').text("Chưa chọn");
        $('#lb_tongdiem').text('Tổng');

        $('.input-mon1').val('');
        $('.input-mon2').val('');
        $('.input-mon3').val('');
        $('.input-tong').val('');

        $('.input-mon1').prop('disabled', false);
        $('.input-mon2').prop('disabled', false);
        $('.input-mon3').prop('disabled', false);
        $('#txt_m1_k1').focus();

        $('#files_hocba').val(null);
        $('#files_cancuoc_congdan').val(null);
        $('#files_bangtn').val(null);
        $('#files_giayto_uutien').val(null);

        $('#files_hocba').prop('disabled', false);
        $('#files_cancuoc_congdan').prop('disabled', false);
        $('#files_bangtn').prop('disabled', false);
        $('#files_giayto_uutien').prop('disabled', false);

        $("#FilesList_HocBa_View tbody").empty();
        $("#FilesList_CCCD_View tbody").empty();
        $("#FilesList_BangTN_View tbody").empty();
        $("#FilesList_GTUT_View tbody").empty();
    }
    function reset_fields_controll_disabled_true() {

        $('#lb_tenmon_1').text("Chưa chọn");
        $('#lb_tenmon_2').text("Chưa chọn");
        $('#lb_tenmon_3').text("Chưa chọn");
        $('#lb_tongdiem').text('Tổng');

        $('.input-mon1').val('');
        $('.input-mon2').val('');
        $('.input-mon3').val('');
        $('.input-tong').val('');

        $('.input-mon1').prop('disabled', true);
        $('.input-mon2').prop('disabled', true);
        $('.input-mon3').prop('disabled', true);
        //$('#txt_m1_k1').focus();

        $('#files_hocba').val(null);
        $('#files_cancuoc_congdan').val(null);
        $('#files_bangtn').val(null);
        $('#files_giayto_uutien').val(null);

        $('#files_hocba').prop('disabled', true);
        $('#files_cancuoc_congdan').prop('disabled', true);
        $('#files_bangtn').prop('disabled', true);
        $('#files_giayto_uutien').prop('disabled', true);


        $("#FilesList_HocBa_View tbody").empty();
        $("#FilesList_CCCD_View tbody").empty();
        $("#FilesList_BangTN_View tbody").empty();
        $("#FilesList_GTUT_View tbody").empty();

    }
    function showToast(title, message, bgColor) {
        $("#myToast .toast-header .me-auto").text(title);
        $("#myToast .toast-body").text(message);
        $("#myToast .toast").removeClass("bg-success bg-danger").addClass(bgColor);
        $("#myToast").toast("show");
    }

    $(document).ready(function () {
        $("#files_hocba").on("change", function () {
            var files_hocba = document.getElementById('files_hocba');

            for (i = 0; i < files_hocba.files.length; i++) {

                var sfilename_hocba = files_hocba.files[i].name;
                let srandomid_hocba = Math.random().toString(36).substring(7);
                formdata_files_hocba.append(sfilename_hocba, files_hocba.files[i]);

                var markup_hocba = "<tr id='" + srandomid_hocba + "'><td>" + sfilename_hocba + "</td><td style='width: 40px!important; color:blue'><a style='text-decoration:none' title='Bấm chuột để xóa tệp nếu không đúng!'  class=\"btn btn-light btn-sm\"  onclick='DeleteFile_HoBas_Upload(\"" + srandomid_hocba + "\",\"" + sfilename_hocba + "\")'>Xóa</a></td></tr>";
                $("#FilesList_HocBa_View tbody").append(markup_hocba);
            }
            chkatchtbl_hocba();
            $('#files_hocba').val('');
        });

        $("#files_cancuoc_congdan").on("change", function () {
            var files_cancuoc_congdan = document.getElementById('files_cancuoc_congdan');

            for (i = 0; i < files_cancuoc_congdan.files.length; i++) {

                var sfilename_cccd = files_cancuoc_congdan.files[i].name;
                let srandomid_cccd = Math.random().toString(36).substring(7);
                formdata_cccd.append(sfilename_cccd, files_cancuoc_congdan.files[i]);
                var markup_cccd = "<tr id='" + srandomid_cccd + "'><td>" + sfilename_cccd + "</td><td style='width: 40px!important; color:blue'><a style='text-decoration:none' title='Bấm chuột để xóa tệp nếu không đúng!'  class=\"btn btn-light btn-sm\"  onclick='DeleteFile_HoBas_Upload(\"" + srandomid_cccd + "\",\"" + sfilename_cccd + "\")'>Xóa</a></td></tr>";
                $("#FilesList_CCCD_View tbody").append(markup_cccd);
            }
            chkatchtbl_cccd();
            $('#files_cancuoc_congdan').val('');
        });

        $("#files_bangtn").on("change", function () {
            var files_bangtn = document.getElementById('files_bangtn');
            for (i = 0; i < files_bangtn.files.length; i++) {

                var sfilename_bang_tn = files_bangtn.files[i].name;
                let srandomid_bang_tn = Math.random().toString(36).substring(7);

                formdata_bang_tn.append(sfilename_bang_tn, files_bangtn.files[i]);
                var markup_bang_tn = "<tr id='" + srandomid_bang_tn + "'><td>" + sfilename_bang_tn + "</td><td style='width: 40px!important; color:blue'><a style='text-decoration:none' title='Bấm chuột để xóa tệp nếu không đúng!'  class=\"btn btn-light btn-sm\"  onclick='DeleteFile_HoBas_Upload(\"" + srandomid_bang_tn + "\",\"" + sfilename_bang_tn + "\")'>Xóa</a></td></tr>";
                $("#FilesList_BangTN_View tbody").append(markup_bang_tn);

            }
            chkatchtbl_bang_tn();
            $('#files_bangtn').val('');
        });

        $("#files_giayto_uutien").on("change", function () {
            var files_giayto_uutien = document.getElementById('files_giayto_uutien');
            for (i = 0; i < files_giayto_uutien.files.length; i++) {

                var sfilename_gtuutien = files_giayto_uutien.files[i].name;
                let srandomid_gtuutien = Math.random().toString(36).substring(7);

                formdata_giayto_uutien.append(sfilename_gtuutien, files_giayto_uutien.files[i]);
                var markup_giayto_uutien = "<tr id='" + srandomid_gtuutien + "'><td>" + sfilename_gtuutien + "</td><td style='width: 40px!important; color:blue'><a style='text-decoration:none' title='Bấm chuột để xóa tệp nếu không đúng!'  class=\"btn btn-light btn-sm\"  onclick='DeleteFile_HoBas_Upload(\"" + srandomid_gtuutien + "\",\"" + sfilename_gtuutien + "\")'>Xóa</a></td></tr>";
                $("#FilesList_GTUT_View tbody").append(markup_giayto_uutien);

            }
            chkatchtbl_giayto_uutien();
            $('#files_giayto_uutien').val('');
        });
    });
    function DeleteFile_HoBas_Upload(Fileid, FileName) {
        formdata_files_hocba.delete(FileName)
        $("#" + Fileid).remove();
        chkatchtbl_hocba();
    }
    function chkatchtbl_hocba() {
        if ($('#FilesList_HocBa_View tr').length > 0) {
            $("#FilesList_HocBa_View").css("visibility", "visible");
            check_in_file_hoba = true;
        }
        else {
            $("#FilesList_HocBa_View").css("visibility", "hidden");
            check_in_file_hoba = false;
            if (!check_in_file_hoba) { var errorMessage = "Vui lòng upload tệp học bạ  (điểm lớp 11 và điểm kỳ 1 lớp 12)"; $('#SP_HocBa_Error').text(errorMessage); flag = false; }
        }
    }

    function DeleteFile_CCCD_View(Fileid, FileName) {
        formdata_cccd.delete(FileName)
        $("#" + Fileid).remove();
        chkatchtbl_cccd();
    }
    function chkatchtbl_cccd() {
        if ($('#FilesList_CCCD_View tr').length > 0) { $("#FilesList_CCCD_View").css("visibility", "visible"); }
        else { $("#FilesList_CCCD_View").css("visibility", "hidden"); }
    }

    function DeleteFile_BangTN_Upload(Fileid, FileName) {
        formdata_bang_tn.delete(FileName)
        $("#" + Fileid).remove();
        chkatchtbl_bang_tn();
    }
    function chkatchtbl_bang_tn() {
        if ($('#FilesList_BangTN_View tr').length > 0) {
            $("#FilesList_BangTN_View").css("visibility", "visible");
        } else {
            $("#FilesList_BangTN_View").css("visibility", "hidden");
        }
    }

    function DeleteFile_GTUT_Upload(Fileid, FileName) {
        formdata_giayto_uutien.delete(FileName)
        $("#" + Fileid).remove();
        chkatchtbl_giayto_uutien();
    }
    function chkatchtbl_giayto_uutien() {
        if ($('#FilesList_GTUT_View tr').length > 0) {
            $("#FilesList_GTUT_View").css("visibility", "visible");
        } else {
            $("#FilesList_GTUT_View").css("visibility", "hidden");
        }
    }

    $(document).ready(function () {
        $('#bt_ok_div_update_aspirations').click(function () {

            let flag = true;

            var _nganh_ID = $('#select_nganh').val();
            var _thm_ID = $('#select_tohopmon').val();

            console.log(_nganh_ID)

            var _dkxt_Diem_M1 = { TenMon: $('#lb_tenmon_1').text(), HK1: $('#txt_m1_k1').val(), HK2: $('#txt_m1_k2').val(), HK3: $('#txt_m1_k3').val(), DiemTrungBinh: $('#txt_tb_m1').val(), };
            var _dkxt_Diem_M2 = { TenMon: $('#lb_tenmon_2').text(), HK1: $('#txt_m2_k1').val(), HK2: $('#txt_m2_k2').val(), HK3: $('#txt_m2_k3').val(), DiemTrungBinh: $('#txt_tb_m2').val(), };
            var _dkxt_Diem_M3 = { TenMon: $('#lb_tenmon_3').text(), HK1: $('#txt_m3_k1').val(), HK2: $('#txt_m3_k2').val(), HK3: $('#txt_m3_k3').val(), DiemTrungBinh: $('#txt_tb_m3').val(), };

            var _diemTBMon1 = $('#txt_tb_m1').val();
            var _diemTBMon2 = $('#txt_tb_m2').val();
            var _diemTBMon3 = $('#txt_tb_m3').val();

            if (_nganh_ID == 0) { var errorMessage = "Chưa chọn ngành"; $('#Nganh_ID_Error').text(errorMessage); flag = false; }
            if (_thm_ID == 0) { var errorMessage = "Chưa chọn tổ hợp môn"; $('#Thm_ID_Error').text(errorMessage); flag = false; }
            if (_diemTBMon1 == '' || _diemTBMon2 == '' || _diemTBMon3 == '') { var errorMessage = "Chưa nhập đủ điểm các môn hoặc nhập chưa đúng, vui lòng kiểm tra lại!"; $('#Diem_All_Error').text(errorMessage); flag = false; }



            /* xử lý phần upload file lên server*/

            let _Dkxt_MinhChung_HB = "";
            let _Dkxt_MinhChung_CCCD = "";
            let _Dkxt_MinhChung_Bang = "";
            let _Dkxt_MinhChung_UuTien = "";

            if (check_in_file_hoba == false) { var errorMessage = "Vui lòng upload tệp học bạ có điểm lớp 11 và điểm kỳ 1 lớp 12"; $('#SP_HocBa_Error').text(errorMessage); flag = false; }
            else {
                let so_file_hb = 0;
                let so_file_cccd = 0;
                let so_file_btn = 0;
                let so_file_gtut = 0;

                let formData_All = new FormData();
                for (const item of formdata_files_hocba) {
                    formData_All.append(item[0], item[1]);
                    so_file_hb++;
                }
                for (const item of formdata_cccd) {
                    formData_All.append(item[0], item[1]);
                    so_file_cccd++;
                }
                for (const item of formdata_bang_tn) {
                    formData_All.append(item[0], item[1]);
                    so_file_btn++;
                }
                for (const item of formdata_giayto_uutien) {
                    formData_All.append(item[0], item[1]);
                    so_file_gtut++;
                }

                formData_All.append('so_file_hb', so_file_hb);
                formData_All.append('so_file_cccd', so_file_cccd);
                formData_All.append('so_file_btn', so_file_btn);
                formData_All.append('so_file_gtut', so_file_gtut);

                $.ajax({
                    url: '/DangKyXetTuyens/DangKyXetTuyen_HB_UploadFile_Multi',
                    type: "POST",
                    contentType: false,
                    processData: false,
                    data: formData_All,
                    async: false,
                    success: function (res) {

                        _Dkxt_MinhChung_HB = res.MinhChung_HB;
                        _Dkxt_MinhChung_CCCD = res.MinhChung_CCCD;
                        _Dkxt_MinhChung_Bang = res.MinhChung_Bang;
                        _Dkxt_MinhChung_UuTien = res.MinhChung_UuTien;
                        check_in_file_hoba = true;
                    },
                    error: function (err) {
                        check_in_file_hoba = false;
                        console(err.statusText);
                    }
                });
            }
            /*hết phần upload file*/
            if (!flag) return;
            var _dkxt_Diem_Tong = parseFloat(_diemTBMon1) + parseFloat(_diemTBMon2) + parseFloat(_diemTBMon3);
            var formData_dknv_new = {
                Nganh_ID: _nganh_ID,
                Thm_ID: _thm_ID,
                Dkxt_HB_Diem_M1: JSON.stringify(_dkxt_Diem_M1),
                Dkxt_HB_Diem_M2: JSON.stringify(_dkxt_Diem_M2),
                Dkxt_HB_Diem_M3: JSON.stringify(_dkxt_Diem_M3),

                Dkxt_HB_Diem_Tong: _dkxt_Diem_Tong.toString(),

                Dkxt_HB_MinhChung_HB: _Dkxt_MinhChung_HB,
                Dkxt_HB_MinhChung_CCCD: _Dkxt_MinhChung_CCCD,
                Dkxt_HB_MinhChung_Bang: _Dkxt_MinhChung_Bang,
                Dkxt_HB_MinhChung_UuTien: _Dkxt_MinhChung_UuTien,
            }
            console.log("new data", formData_dknv_new);


            $("#loadingModal").modal("show");

            $.ajax({
                url: "/DangKyXetTuyens/DangKyXetTuyen_HB_Create",
                data: JSON.stringify(formData_dknv_new),
                type: 'POST',
                contentType: 'application/json;charset=utf-8',
                dataType: 'json',
                success: function (res) {
                    if (res.success) {
                        LoadData_All_DkxtHB();
                        reset_fields_controll_disabled_true();
                        $('#div_list_aspirations').css('display', 'inline');
                        $('#div_update_aspirations').css('display', 'none');
                        $("#loadingModal").modal("hide");
                        thongbao_dangky_thanhcong(res.data);
                    } else {
                        showToast("Thông báo", "Có lỗi xảy ra khi thêm mới nguyện vọng!", "bg-error");
                        $("#loadingModal").modal("hide");
                    }
                },
                error: function (errormessage) {
                    showToast("Thông báo", "Có lỗi xảy ra khi thêm mới nguyện vọng!", "bg-error");
                    $("#loadingModal").modal("hide");
                }
            });

        });
        // button tắt cửa sổ thêm mới phía trên
        $('#bt_close_div_update_aspirations_first').click(function () {
            document.getElementById('div_list_aspirations').style.display = "inline";
            document.getElementById('div_update_aspirations').style.display = "none";
            $('#dkxt_hocba_id_checkin').val('');
            reset_fields_controll_disabled_true();
        });
        // button tắt cửa sổ thêm mới phía dưới
        $('#bt_close_div_update_aspirations_second').click(function () {
            document.getElementById('div_list_aspirations').style.display = "inline";
            document.getElementById('div_update_aspirations').style.display = "none";
            $('#dkxt_hocba_id_checkin').val('');
            reset_fields_controll_disabled_true();
            $('.text-danger').text('');
        });
    });


    $(document).ready(function () {
        $('#bt_xuat_phieu_tong_hop_kq').click(function () {
            window.location.href = '/ExportFile/DownloadFile_XetTuyenHB';
        });
    });
    $(document).ready(function () {
        $('#bt_xuat_phieu_tong_hop').click(function () {
            window.location.href = '/ExportFile/DownloadFile_XetTuyenHB';
        });
    });
</script>